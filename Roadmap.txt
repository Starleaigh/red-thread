Investigator Sheet

Finish all investigator pages
- No refactors
- No partials yet
- Add Photo

Add drag-mode scaling - DONE
 - One CSS class
 - Applied only during drag

Resize opition

Add shadow and offset for page depth again
- Only on paper pages
- folder can have separate shadow style

Freeze the investigator sheet
- This becomes the gold standard

Only after that do we extract:
- casefile folders
- POI folders
- shared partials
- socket locking

--------------------

Issues

Investigators are not renamed in the Actor Folders and become do not open after dragging to the board unless link actor is checked. Token Name does not update on updating actor.name
--- This is fixed upon a refresh after Link actor sheet is checked

--- Page sounds play for everyone


--------------------------------
CSS Clean up

/* BASE: all pages */
.page .front,
.page .back {
  position: absolute;
  top: 0;
  height: 100%;
  backface-visibility: hidden;
}

/* PAPER overrides */
.page.paper .front,
.page.paper .back {
  left: var(--spine-width);
  width: calc(100% - var(--spine-width));
}

/* FOLDER overrides */
.page.folder .front,
.page.folder .back {
  left: 0;
  width: 100%;
}

Move all inline styles to CSS if possible

----------------------------------

Move to partials - elegance upgrade

Instead of:

{{#if (eq page.index 2)}}
  ...profile page...
{{/if}}


Do this:

<section class="page {{page.state}} {{page.type}}" data-index="{{page.index}}">
  {{> (lookup . "partial") }}
</section>


And in context: (partial may take over title?)

pagesData = [
  { index: 0, type: "folder", partial: "page-folder-front", state },
  { index: 1, type: "paper",  partial: "page-cover", state },
  { index: 2, type: "paper",  partial: "page-profile", state },
  ...
];


This:

deletes ~60% of the template logic
makes page meaning explicit
keeps animations untouched


Extract common page chrome into a wrapper partial

Example partial: page-base.hbs

<div class="page-spine draggable"></div>

<div class="front">
  {{> @partial-block }}
</div>

<div class="back">
  {{#if back}}
    {{> back }}
  {{/if}}
</div>


Then page content becomes:

{{#> page-base}}
  ...profile content...
{{/page-base}}


This keeps:
- DOM consistent
- spine logic unified
- future changes easy

Will need to use a unique id if we want players to be able to create pages



DATA MODEL EXAMPLE
Functions pointed to from class
------------------------------------

// items/skills.js
export function skillValue(item) {
  const base = item.system.base ?? 0;
  const occupation = item.system.occupation ? 20 : 0;
  return base + occupation;
}

export function skillHalf(item) {
  return Math.floor(skillValue(item) / 2);
}

---------------------------------------

// items/weapons.js
export async function rollWeaponDamage(item) {
  if (!item.isWeapon) return null;
  return new Roll(item.system.damage).roll({async: true});
}

--------------------------------------
//red-thread-tiem.js

import * as Skills from "./skills.js";
import * as Weapons from "./weapons.js";

export class RedThreadItem extends Item {

  get isSkill() { return this.type === "skill"; }
  get isWeapon() { return this.type === "weapon"; }

  get value() {
    if (this.isSkill) return Skills.skillValue(this);
    return null;
  }

  get half() {
    if (this.isSkill) return Skills.skillHalf(this);
    return null;
  }

  async rollDamage() {
    if (this.isWeapon) return Weapons.rollWeaponDamage(this);
  }
}



--------------------------------------
System	            Actor class & data model	      Item class & data model	      Compendium items
Cthulhu	            InvestigatorDataModel	          CthulhuItem	                  Skills, weapons, notes
Red Thread / Noir	  NoirInvestigatorDataModel	      NoirItem	                    Skills, gadgets, weapons







this.element.addEventListener("input", async (event) => {
  const input = event.target;
  const skillId = input.closest("[data-skill-id]")?.dataset.skillId;
  if (!skillId) return;

  const value = Number(input.value) || 0;
  const skill = this.actor.items.get(skillId);
  if (!skill) return;

  await skill.update({ "system.base": value }, { render: false });

  // Update half/fifth immediately
  const derived = input.closest("li").querySelector(".derived");
  if (derived) {
    derived.textContent = `Half: ${skill.half} | Fifth: ${skill.fifth}`;
  }
});